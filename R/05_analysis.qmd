---
title: "Analyse data"
format: html
editor: source
author: authors
---

### Source functions

```{r}
source("../R/99_proj_func.R")
```

### Library

```{r}
#| eval: true
#| echo: true
#| warning: false

library("tidyverse")
library("Racmacs")
library("viridis")
library("ggrepel")
library("svglite")
library("ggforce")
library("dbscan")
library("RColorBrewer")



```

### Loading

```{r}
file_path <- file.path(getwd(), "../data/map.ace")

map <- read.acmap(
  file_path,
  optimization_number = NULL,
  sort_optimizations = FALSE,
  align_optimizations = FALSE
)

attr_table_ag <- read_tsv(file = "../data/attr_table_ag.tsv")
attr_table_sr <- read_tsv(file = "../data/attr_table_sr.tsv")
table_info <- read_tsv(file = "../data/table_info.tsv")


```

```{r}

print(mapStress(map))

#### UNCERTAINTY
#### UNCERTAINTY
#### UNCERTAINTY
triangulationBlobs(
  map,
  optimization_number = 10,
  stress_lim = 1,
  grid_spacing = 0.25,
  antigens = TRUE,
  sera = TRUE,
  .check_relaxation = TRUE,
  .options = list()
)

bootstrapMap(
  map,
  method = "resample", #"resample", "bayesian" or "noisy"
  bootstrap_repeats = 1000,
  bootstrap_ags = TRUE,
  bootstrap_sr = TRUE,
  reoptimize = TRUE,
  optimizations_per_repeat = 100,
  ag_noise_sd = 0.7,
  titer_noise_sd = 0.7,
  options = list()
)

bootstrapBlobs(
  map,
  conf.level = 0.68,
  smoothing = 6,
  gridspacing = 0.25,
  antigens = TRUE,
  sera = TRUE,
  method = "ks"
)

```

