---
title: "Antigenic mapping report"
author: "Magnus Hilarius Ohlin Jepsen and Oliver Sellberg"
date: today
date-format: "DD/MM/YYYY"

format:
  pdf:
    toc: true
    number-sections: true
    colorlinks: true
---

# Antigenic mapping
```{r setup, include=FALSE}
source("../R/99_proj_func.R")

library("fs")
library("knitr")
library("readr")
library("dplyr")
library("pander")
library("gt")
library("DT")

table_info <- read_tsv(file = "../data/table_info.tsv")
titer_clean <- read_tsv(file = "../data/titer_clean.tsv")
virus_type <- table_info$virus_type[1]
ag_names <- read_tsv(file = "../data/ag_names.tsv")
attr_table_ag <- read_tsv(file = "../data/attr_table_ag.tsv")
attr_table_sr <- read_tsv(file = "../data/attr_table_sr.tsv")
# Base path and initial folder name components
base_path <- "../results"

folder_prefix <- paste("ac_map_", virus_type, "_", sep = "") # Concatenates the base folder name with the virus type
today_date <- format(Sys.Date(), "%Y-%m-%d")
virus_in_use <- table_info |> pull(virus_type)

# Function to get the highest version folder
titer_clean <- bind_cols(ag_names, titer_clean)

# Determine the latest version folder for today's date
latest_folder_path <- get_latest_version_folder(base_path, folder_prefix, today_date)

```

## Data information

### **First 5 rows and columns of titer table**
```{r, echo = FALSE}
titer_clean |> 
  head(5) |> 
  select(1:5) |> 
  kable()
```

### **Information about the dataset**
```{r, echo = FALSE}
knitr::kable(table_info)
```

### **Antigen attribute table**
First 5 rows of the antigen attribute table
```{r, echo = FALSE}
attr_table_ag |> 
  head(5) |> 
  kable()
```   

### **Serum attribute table**
First 5 rows of the serum attribute table
```{r, echo = FALSE}
attr_table_sr |> 
  head(5) |> 
  kable()
```

\vspace{10pt}

## Mapping

### Antigenic map - colored by type - with legend
```{r, echo = FALSE}
# Include graphic for antigenic map colored by type - with legend
file_path_type_legend <- file.path(latest_folder_path, paste0("ac_map_",virus_in_use, "_", today_date, ".jpg"))
knitr::include_graphics(file_path_type_legend)
```

### Antigenic map - colored by type - with labels
```{r, echo = FALSE}
# Include graphic for antigenic map colored by type - with labels
file_path_type_labels <- file.path(latest_folder_path, paste0("ac_map_",virus_in_use, "_", today_date, "_label.jpg"))
knitr::include_graphics(file_path_type_labels)
```

### Antigenic map - colored by antigenic group - with legend

```{r, echo = FALSE}
# Include graphic for antigenic map colored by antigenic group - with legend
file_path_group_legend <- file.path(latest_folder_path, paste0("ac_map_",virus_in_use, "_", today_date, "_grouped.jpg"))
knitr::include_graphics(file_path_group_legend)
```

### Antigenic map - colored by antigenic group - with labels
```{r, echo = FALSE}
# Include graphic for antigenic map colored by antigenic group - with labels
file_path_group_labels <- file.path(latest_folder_path, paste0("ac_map_",virus_in_use, "_",today_date, "_grouped_label.jpg"))
knitr::include_graphics(file_path_group_labels)
```

### Antigenic map blank
```{r, echo = FALSE}
# Include graphic for blank antigenic map
file_path_blank <- file.path(latest_folder_path, paste0("ac_map_",virus_in_use, "_", today_date, "_plain.jpg"))
knitr::include_graphics(file_path_blank)
```
